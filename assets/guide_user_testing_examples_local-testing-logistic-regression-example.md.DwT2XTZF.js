import{_ as a,c as i,a0 as n,o as t}from"./chunks/framework.BGabeMLJ.js";const o=JSON.parse('{"title":"Local Testing in FLAME: Pancreatic Cancer Analysis","description":"","frontmatter":{},"headers":[],"relativePath":"guide/user/testing_examples/local-testing-logistic-regression-example.md","filePath":"guide/user/testing_examples/local-testing-logistic-regression-example.md"}'),e={name:"guide/user/testing_examples/local-testing-logistic-regression-example.md"};function l(p,s,h,r,d,k){return t(),i("div",null,s[0]||(s[0]=[n(`<h1 id="local-testing-in-flame-pancreatic-cancer-analysis" tabindex="-1">Local Testing in FLAME: Pancreatic Cancer Analysis <a class="header-anchor" href="#local-testing-in-flame-pancreatic-cancer-analysis" aria-label="Permalink to &quot;Local Testing in FLAME: Pancreatic Cancer Analysis&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">INFO</p><p>For an explanation of this example&#39;s main code, please refer to the <a href="/guide/user/coding_examples/federated-logistic-regression.html">federated logistic regression coding example</a>.</p></div><h2 id="_1-initializing-local-testing" tabindex="-1">1. Initializing Local Testing <a class="header-anchor" href="#_1-initializing-local-testing" aria-label="Permalink to &quot;1. Initializing Local Testing&quot;">​</a></h2><p>Other than the coding example, here we simulate node-local data by loading CSV files from local directories instead of S3 buckets. The data structure mimics S3 objects by encoding the CSV content as bytes.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Load node-local CSV files and encode as bytes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node1/pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).read().encode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">            open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node2/pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).read().encode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    }]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Combine node data into federated data splits</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_splits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [data_1, data_2]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Run federated training</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    StarModelTester(</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        data_splits,                    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List of node-local datasets</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PancreasAnalyzer,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Analyzer class</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FederatedLogisticRegression,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Aggregator class</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Data source type</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        simple_analysis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Multi-round analysis</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        output_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pickle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output format</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        result_filepath</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;./pancreas.pkl&quot;</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Save final model</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><h3 id="_1-1-data-preparation" tabindex="-1">1.1. Data Preparation: <a class="header-anchor" href="#_1-1-data-preparation" aria-label="Permalink to &quot;1.1. Data Preparation:&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [{</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;node1/pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).read().encode(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;utf-8&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}]</span></span></code></pre></div><p>This creates a specific data structure:</p><ul><li><strong>List</strong>: <code>[...]</code> - Each node gets one list entry</li><li><strong>Dictionary</strong>: <code>{&#39;pancreasData.csv&#39;: &lt;bytes&gt;}</code> - Maps filenames to content</li><li><strong>Bytes</strong>: <code>.encode(&#39;utf-8&#39;)</code> - Converts string to bytes (simulating S3 objects)</li></ul><p><strong>Why this structure?</strong></p><ul><li>Mimics real federated deployments where data comes from S3 buckets</li><li>Each node might have multiple files (hence the dictionary)</li><li>Bytes representation prepares for network transmission</li></ul><h3 id="_1-2-starmodeltester-configuration" tabindex="-1">1.2. StarModelTester Configuration: <a class="header-anchor" href="#_1-2-starmodeltester-configuration" aria-label="Permalink to &quot;1.2. StarModelTester Configuration:&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Parameter</th><th>Value</th><th>Purpose</th></tr></thead><tbody><tr><td><code>data_splits</code></td><td><code>[data_1, data_2]</code></td><td>Two nodes (hospitals)</td></tr><tr><td><code>PancreasAnalyzer</code></td><td>Class</td><td>Local training logic</td></tr><tr><td><code>FederatedLogisticRegression</code></td><td>Class</td><td>Aggregation logic</td></tr><tr><td><code>&#39;s3&#39;</code></td><td>Data type</td><td>Treats data as S3-like objects</td></tr><tr><td><code>simple_analysis=False</code></td><td>Iterative</td><td>Enables multi-round training</td></tr><tr><td><code>output_type=&#39;pickle&#39;</code></td><td>Format</td><td>Serializes the final model</td></tr><tr><td><code>result_filepath</code></td><td>Path</td><td>Saves model to disk</td></tr></tbody></table><h2 id="_2-running-the-example" tabindex="-1">2. Running the Example <a class="header-anchor" href="#_2-running-the-example" aria-label="Permalink to &quot;2. Running the Example&quot;">​</a></h2><h3 id="_2-1-prerequisites-not-mandatory-just-for-clarity-in-this-example" tabindex="-1">2.1. Prerequisites (not mandatory, just for clarity in this example) <a class="header-anchor" href="#_2-1-prerequisites-not-mandatory-just-for-clarity-in-this-example" aria-label="Permalink to &quot;2.1. Prerequisites (not mandatory, just for clarity in this example)&quot;">​</a></h3><ol><li><p><strong>Project structure</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>test/</span></span>
<span class="line"><span>├── test_flame_pancreas_analysis.py</span></span>
<span class="line"><span>├── node1/</span></span>
<span class="line"><span>│   └── pancreasData.csv</span></span>
<span class="line"><span>└── node2/</span></span>
<span class="line"><span>    └── pancreasData.csv</span></span></code></pre></div></li><li><p><strong>Data format</strong> (pancreasData.csv):</p><div class="language-csv vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">csv</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">feature1,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">feature2,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">feature3,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">...,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">label</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">0.5,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">1.2,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">3.4,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">...,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">0.8,</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">1.5,</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">2.9,</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">...,</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">1</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">...</span></span></code></pre></div><ul><li>Multiple feature columns (patient measurements)</li><li>Last column is binary label (0 = healthy, 1 = disease)</li></ul></li></ol><h3 id="_2-2-running-the-test" tabindex="-1">2.2. Running the Test <a class="header-anchor" href="#_2-2-running-the-test" aria-label="Permalink to &quot;2.2. Running the Test&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_flame_pancreas_analysis.py</span></span></code></pre></div><h3 id="_2-3-expected-output" tabindex="-1">2.3. Expected Output <a class="header-anchor" href="#_2-3-expected-output" aria-label="Permalink to &quot;2.3. Expected Output&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--- Starting Iteration 0 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>--- Ending Iteration 0 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 1 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>--- Ending Iteration 1 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>*** ... (similar output for iterations 2 through 9) ... ***</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 10 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>	Data extracted: [{&#39;pancreasData.csv&#39;: b&#39;5S_rRNA,7SK,A1BG,A1BG-AS1,A1CF,A2M,A2M-AS1,A2ML1,A4GALT,A4GNT,AA06,AAAS,AACS</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>Maximum number of 10 iterations reached. Returning current results.</span></span>
<span class="line"><span>Maximum number of 10 iterations reached. Returning current results.</span></span>
<span class="line"><span>Final result written to ./pancreas.pkl</span></span>
<span class="line"><span>--- Ending Iteration 10 ---</span></span></code></pre></div><h2 id="_3-loading-the-trained-model" tabindex="-1">3. Loading the Trained Model <a class="header-anchor" href="#_3-loading-the-trained-model" aria-label="Permalink to &quot;3. Loading the Trained Model&quot;">​</a></h2><p>If you want to load and use the trained model later, you can do so with the following code:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Load the trained model coefficients</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> open</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pancreas.pkl&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;rb&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> f:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    global_coefficients </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pickle.load(f)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Model coefficients: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global_coefficients</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">print</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Shape: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global_coefficients.shape</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Use the model for predictions</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># (You&#39;d need to reconstruct a LogisticRegression object)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LogisticRegression(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">fit_intercept</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">clf.coef_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global_coefficients</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># clf.classes_ = np.array([0, 1])  # Set class labels</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># predictions = clf.predict(new_patient_data)</span></span></code></pre></div>`,23)]))}const g=a(e,[["render",l]]);export{o as __pageData,g as default};
