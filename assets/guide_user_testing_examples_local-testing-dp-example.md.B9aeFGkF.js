import{_ as i,c as a,a0 as n,o as t}from"./chunks/framework.BGabeMLJ.js";const o=JSON.parse('{"title":"Local Testing in FLAME: Star Pattern with Differential Privacy","description":"","frontmatter":{},"headers":[],"relativePath":"guide/user/testing_examples/local-testing-dp-example.md","filePath":"guide/user/testing_examples/local-testing-dp-example.md"}'),e={name:"guide/user/testing_examples/local-testing-dp-example.md"};function l(p,s,h,k,r,d){return t(),a("div",null,s[0]||(s[0]=[n(`<h1 id="local-testing-in-flame-star-pattern-with-differential-privacy" tabindex="-1">Local Testing in FLAME: Star Pattern with Differential Privacy <a class="header-anchor" href="#local-testing-in-flame-star-pattern-with-differential-privacy" aria-label="Permalink to &quot;Local Testing in FLAME: Star Pattern with Differential Privacy&quot;">​</a></h1><div class="info custom-block"><p class="custom-block-title">INFO</p><p>For an explanation of differential privacy concepts and the Star pattern, please refer to the <a href="/guide/user/local-testing.html">Star Pattern Testing Guide</a> and <a href="/guide/user/coding_examples/differential-privacy-mvp.html">Differential Privacy Documentation</a>.</p></div><h2 id="_1-initializing-local-testing-with-differential-privacy" tabindex="-1">1. Initializing Local Testing with Differential Privacy <a class="header-anchor" href="#_1-initializing-local-testing-with-differential-privacy" aria-label="Permalink to &quot;1. Initializing Local Testing with Differential Privacy&quot;">​</a></h2><p>This example demonstrates how to test federated learning with <strong>Local Differential Privacy</strong> locally before deployment. Unlike regular Star pattern testing, this adds calibrated noise to aggregated results to prevent reverse-engineering of individual node contributions.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> typing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Any, Optional</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flame.star </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StarModelTester, StarAnalyzer, StarAggregator</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyAnalyzer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StarAnalyzer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, flame):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flame)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> analysis_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, data, aggregator_results):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Aggregator results in MyAnalyzer: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">aggregator_results</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;debug&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        analysis_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyAnalysis result (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analysis_result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;notice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> analysis_result</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> MyAggregator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StarAggregator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, flame):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flame)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results: list[Any]) -&gt; Any:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Analysis results in MyAggregator: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analysis_results</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;notice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;MyAggregator result (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.id</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">): </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;notice&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_converged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, result: Any, last_result: Optional[Any]) -&gt; </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">bool</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Last result: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">last_result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">, Current result: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;notice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">\\t</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Checking convergence at iteration </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;notice&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Limit to 5 iterations for testing</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __name__</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ==</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;__main__&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data_splits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [data_1, data_2]</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    StarModelTester(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        data_splits</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_splits,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List of node-local datasets</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        analyzer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MyAnalyzer,         </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Custom Analyzer class</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        aggregator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MyAggregator,     </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Custom Aggregator class</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        data_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,              </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Data source type</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        simple_analysis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,       </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Enable multi-iteration training</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Privacy budget</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">                # Sensitivity parameter (10**0 = 1)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><h3 id="_1-1-data-preparation" tabindex="-1">1.1. Data Preparation: <a class="header-anchor" href="#_1-1-data-preparation" aria-label="Permalink to &quot;1.1. Data Preparation:&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_1 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">3</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_2 </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">6</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">7</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_splits </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> [data_1, data_2]</span></span></code></pre></div><p>This creates a simple data structure for testing:</p><ul><li><strong><code>data_1</code></strong>: Simulates data from Node 1 (e.g., Hospital A)</li><li><strong><code>data_2</code></strong>: Simulates data from Node 2 (e.g., Hospital B)</li><li><strong><code>data_splits</code></strong>: List where each element represents one node&#39;s local data</li></ul><p><strong>Why this structure?</strong></p><ul><li>Mimics federated deployments where each node has isolated data</li><li>Simple numeric lists make it easy to verify differential privacy noise</li><li>Each node processes data independently before aggregation</li></ul><h3 id="_1-2-starmodeltester-configuration-with-differential-privacy" tabindex="-1">1.2. StarModelTester Configuration with Differential Privacy: <a class="header-anchor" href="#_1-2-starmodeltester-configuration-with-differential-privacy" aria-label="Permalink to &quot;1.2. StarModelTester Configuration with Differential Privacy:&quot;">​</a></h3><table tabindex="0"><thead><tr><th>Parameter</th><th>Value</th><th>Purpose</th></tr></thead><tbody><tr><td><code>data_splits</code></td><td><code>[data_1, data_2]</code></td><td>Two nodes with local data</td></tr><tr><td><code>MyAnalyzer</code></td><td>Class</td><td>Local analysis logic at each node</td></tr><tr><td><code>MyAggregator</code></td><td>Class</td><td>Global aggregation logic</td></tr><tr><td><code>&#39;s3&#39;</code></td><td>Data type</td><td>Treats data as direct objects</td></tr><tr><td><code>simple_analysis=False</code></td><td>Iterative</td><td>Enables multi-round federated learning</td></tr><tr><td><code>epsilon=1</code></td><td>Privacy budget</td><td>Moderate privacy protection</td></tr><tr><td><code>sensitivity=1</code></td><td>Sensitivity</td><td>Max individual contribution (10**0 = 1)</td></tr></tbody></table><p><strong>Key Difference from Regular Star Pattern:</strong></p><ul><li><strong><code>epsilon</code></strong> and <strong><code>sensitivity</code></strong> parameters enable differential privacy</li><li>Laplace noise is automatically added to aggregated results</li><li>Noise scale = <code>sensitivity / epsilon = 1 / 1 = 1.0</code></li></ul><h2 id="_2-understanding-the-analysis-logic" tabindex="-1">2. Understanding the Analysis Logic <a class="header-anchor" href="#_2-understanding-the-analysis-logic" aria-label="Permalink to &quot;2. Understanding the Analysis Logic&quot;">​</a></h2><h3 id="_2-1-myanalyzer-class" tabindex="-1">2.1. MyAnalyzer Class <a class="header-anchor" href="#_2-1-myanalyzer-class" aria-label="Permalink to &quot;2.1. MyAnalyzer Class&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> analysis_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, data, aggregator_results):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    analysis_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> \\</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        else</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> /</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> analysis_result</span></span></code></pre></div><p><strong>Iteration 0 (First Round):</strong></p><ul><li><code>aggregator_results</code> is <code>None</code></li><li>Node 1: <code>sum([1,2,3,4]) / 4 = 2.5</code></li><li>Node 2: <code>sum([5,6,7,8]) / 4 = 6.5</code></li></ul><p><strong>Subsequent Iterations:</strong></p><ul><li>Uses feedback from previous aggregation</li><li>Blends local average with global result</li><li>Formula: <code>(local_avg + global_result) + 0.5</code></li></ul><p><strong>Example for Node 1 in Iteration 1:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">local_avg </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 2.5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">global_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> Iteration </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">with</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> noise)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">analysis_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> +</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 4.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0.5</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 7.5</span></span></code></pre></div><h3 id="_2-2-myaggregator-class" tabindex="-1">2.2. MyAggregator Class <a class="header-anchor" href="#_2-2-myaggregator-class" aria-label="Permalink to &quot;2.2. MyAggregator Class&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> result</span></span></code></pre></div><p><strong>Iteration 0 Example:</strong></p><ul><li>Receives: <code>[2.5, 6.5]</code> from both analyzers</li><li>Computes: <code>(2.5 + 6.5) / 2 = 4.5</code> (true result)</li><li><strong>DP Noise Added</strong>: Result becomes <code>4.5 + noise</code> (e.g., <code>4.523891</code>)</li><li>Returns noisy result to nodes</li></ul><p><strong>How Differential Privacy Works:</strong></p><ol><li>Aggregator computes true result: <code>4.5</code></li><li>System samples noise: <code>Laplace(scale=1.0)</code> → e.g., <code>+0.024</code></li><li>Noisy result sent to Hub and back to analyzers: <code>4.524</code></li></ol><h3 id="_2-3-convergence-logic" tabindex="-1">2.3. Convergence Logic <a class="header-anchor" href="#_2-3-convergence-logic" aria-label="Permalink to &quot;2.3. Convergence Logic&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_converged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, result, last_result):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span></code></pre></div><p><strong>Simple iteration-based stopping:</strong></p><ul><li>Stops after 5 iterations</li><li>More sophisticated approaches could check: <ul><li>Change between iterations: <code>abs(result - last_result) &lt; threshold</code></li><li>But must account for DP noise in threshold!</li></ul></li></ul><h2 id="_3-running-the-example" tabindex="-1">3. Running the Example <a class="header-anchor" href="#_3-running-the-example" aria-label="Permalink to &quot;3. Running the Example&quot;">​</a></h2><h3 id="_3-1-prerequisites" tabindex="-1">3.1. Prerequisites <a class="header-anchor" href="#_3-1-prerequisites" aria-label="Permalink to &quot;3.1. Prerequisites&quot;">​</a></h3><ol><li><p><strong>Project structure</strong>:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>test/</span></span>
<span class="line"><span>└── test_star_pattern_dp.py</span></span></code></pre></div></li><li><p><strong>Dependencies</strong>:</p><ul><li><code>flame</code> package with Star pattern support</li><li><code>opendp</code> library (for Laplace noise generation)</li></ul></li></ol><h3 id="_3-2-running-the-test" tabindex="-1">3.2. Running the Test <a class="header-anchor" href="#_3-2-running-the-test" aria-label="Permalink to &quot;3.2. Running the Test&quot;">​</a></h3><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">cd</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test/</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_star_pattern_dp.py</span></span></code></pre></div><h3 id="_3-3-expected-output" tabindex="-1">3.3. Expected Output <a class="header-anchor" href="#_3-3-expected-output" aria-label="Permalink to &quot;3.3. Expected Output&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>--- Starting Iteration 0 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: None</span></span>
<span class="line"><span>MyAnalysis result (node_0): 2.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: None</span></span>
<span class="line"><span>MyAnalysis result (node_1): 6.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [2.5, 6.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 4.5</span></span>
<span class="line"><span>        Last result: None, Current result: 4.5</span></span>
<span class="line"><span>        Checking convergence at iteration 0</span></span>
<span class="line"><span>Aggregated results: 4.5</span></span>
<span class="line"><span>--- Ending Iteration 0 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 1 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 4.5</span></span>
<span class="line"><span>MyAnalysis result (node_0): 7.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 4.5</span></span>
<span class="line"><span>MyAnalysis result (node_1): 11.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [7.5, 11.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 9.5</span></span>
<span class="line"><span>        Last result: 4.5, Current result: 9.5</span></span>
<span class="line"><span>        Checking convergence at iteration 1</span></span>
<span class="line"><span>Aggregated results: 9.5</span></span>
<span class="line"><span>        Last result: 4.5, Current result: 9.5</span></span>
<span class="line"><span>        Checking convergence at iteration 1</span></span>
<span class="line"><span>--- Ending Iteration 1 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 2 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 9.5</span></span>
<span class="line"><span>MyAnalysis result (node_0): 12.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 9.5</span></span>
<span class="line"><span>MyAnalysis result (node_1): 16.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [12.5, 16.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 14.5</span></span>
<span class="line"><span>        Last result: 9.5, Current result: 14.5</span></span>
<span class="line"><span>        Checking convergence at iteration 2</span></span>
<span class="line"><span>Aggregated results: 14.5</span></span>
<span class="line"><span>        Last result: 9.5, Current result: 14.5</span></span>
<span class="line"><span>        Checking convergence at iteration 2</span></span>
<span class="line"><span>--- Ending Iteration 2 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 3 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 14.5</span></span>
<span class="line"><span>MyAnalysis result (node_0): 17.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 14.5</span></span>
<span class="line"><span>MyAnalysis result (node_1): 21.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [17.5, 21.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 19.5</span></span>
<span class="line"><span>        Last result: 14.5, Current result: 19.5</span></span>
<span class="line"><span>        Checking convergence at iteration 3</span></span>
<span class="line"><span>Aggregated results: 19.5</span></span>
<span class="line"><span>        Last result: 14.5, Current result: 19.5</span></span>
<span class="line"><span>        Checking convergence at iteration 3</span></span>
<span class="line"><span>--- Ending Iteration 3 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 4 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 19.5</span></span>
<span class="line"><span>MyAnalysis result (node_0): 22.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 19.5</span></span>
<span class="line"><span>MyAnalysis result (node_1): 26.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [22.5, 26.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 24.5</span></span>
<span class="line"><span>        Last result: 19.5, Current result: 24.5</span></span>
<span class="line"><span>        Checking convergence at iteration 4</span></span>
<span class="line"><span>Aggregated results: 24.5</span></span>
<span class="line"><span>        Last result: 19.5, Current result: 24.5</span></span>
<span class="line"><span>        Checking convergence at iteration 4</span></span>
<span class="line"><span>--- Ending Iteration 4 ---</span></span>
<span class="line"><span></span></span>
<span class="line"><span>--- Starting Iteration 5 ---</span></span>
<span class="line"><span>Analyzer node_0 started</span></span>
<span class="line"><span>        Data extracted: [1, 2, 3, 4]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 24.5</span></span>
<span class="line"><span>MyAnalysis result (node_0): 27.5</span></span>
<span class="line"><span>Analyzer node_1 started</span></span>
<span class="line"><span>        Data extracted: [5, 6, 7, 8]</span></span>
<span class="line"><span>        Aggregator results in MyAnalyzer: 24.5</span></span>
<span class="line"><span>MyAnalysis result (node_1): 31.5</span></span>
<span class="line"><span>Aggregator started</span></span>
<span class="line"><span>        Analysis results in MyAggregator: [27.5, 31.5]</span></span>
<span class="line"><span>MyAggregator result (node_2): 29.5</span></span>
<span class="line"><span>        Last result: 24.5, Current result: 29.5</span></span>
<span class="line"><span>        Checking convergence at iteration 5</span></span>
<span class="line"><span>Aggregated results: 29.5</span></span>
<span class="line"><span>        Test mode: Would apply local DP with epsilon=1 and sensitivity=1</span></span>
<span class="line"><span>        Last result: 24.5, Current result: 30.186171397668105</span></span>
<span class="line"><span>        Checking convergence at iteration 5</span></span>
<span class="line"><span>Final result: 30.186171397668105</span></span>
<span class="line"><span>--- Ending Iteration 5 ---</span></span></code></pre></div><h3 id="_3-4-analyzing-the-output" tabindex="-1">3.4. Analyzing the Output <a class="header-anchor" href="#_3-4-analyzing-the-output" aria-label="Permalink to &quot;3.4. Analyzing the Output&quot;">​</a></h3><p><strong>Key Observations:</strong></p><ol><li><p><strong>Differential Privacy Noise in Action:</strong></p><ul><li>True result (Iteration 5): <code>29.5</code></li><li>Noisy result: <code>30.186171397668105</code></li><li>Noise added: <code>~0.686</code> from Laplace distribution</li></ul></li><li><p><strong>Noise added at the last Iteration:</strong></p><ul><li>Only the final aggregated result has DP noise</li><li>Intermediate results are exact averages</li></ul></li><li><p><strong>Privacy Preserved:</strong></p><ul><li>Cannot determine exact individual node contributions from aggregated results</li><li>Noise makes it infeasible to reverse-engineer original data</li></ul></li></ol><h2 id="_4-best-practices-for-dp-testing" tabindex="-1">4. Best Practices for DP Testing <a class="header-anchor" href="#_4-best-practices-for-dp-testing" aria-label="Permalink to &quot;4. Best Practices for DP Testing&quot;">​</a></h2><h3 id="_4-1-start-without-privacy" tabindex="-1">4.1. Start Without Privacy <a class="header-anchor" href="#_4-1-start-without-privacy" aria-label="Permalink to &quot;4.1. Start Without Privacy&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Step 1: Test basic logic without DP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StarModelTester(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">simple_analysis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># No epsilon/sensitivity</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Step 2: Add weak DP to verify it works</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StarModelTester(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Step 3: Use realistic privacy levels</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StarModelTester(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="_4-2-document-your-privacy-choices" tabindex="-1">4.2. Document Your Privacy Choices <a class="header-anchor" href="#_4-2-document-your-privacy-choices" aria-label="Permalink to &quot;4.2. Document Your Privacy Choices&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Privacy Parameters:</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- epsilon = 1.0 (moderate privacy)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- sensitivity = 1.0 (assuming max individual contribution of 1)</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- Total privacy budget: epsilon * num_iterations = 1.0 * 5 = 5.0</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">- Rationale: Balances utility with privacy for testing purposes</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&quot;&quot;</span></span></code></pre></div><h3 id="_4-3-validate-noise-impact-only-during-testing" tabindex="-1">4.3. Validate Noise Impact (only during testing) <a class="header-anchor" href="#_4-3-validate-noise-impact-only-during-testing" aria-label="Permalink to &quot;4.3. Validate Noise Impact (only during testing)&quot;">​</a></h3><p>Add logging to track noise (you must not do so productively):</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    true_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;True result before DP noise: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">true_result</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;notice&#39;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> true_result</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # DP noise added automatically after this method returns</span></span></code></pre></div><h3 id="_4-4-test-multiple-runs" tabindex="-1">4.4. Test Multiple Runs <a class="header-anchor" href="#_4-4-test-multiple-runs" aria-label="Permalink to &quot;4.4. Test Multiple Runs&quot;">​</a></h3><p>Since DP adds random noise, run multiple times:</p><div class="language-bash vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">for</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> i </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">in</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">1..10}</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">; </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;Run </span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$i</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">    python</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test_star_pattern_dp.py</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">done</span></span></code></pre></div><p>Collect results to understand noise distribution and variability.</p><h2 id="_5-common-issues-and-solutions" tabindex="-1">5. Common Issues and Solutions <a class="header-anchor" href="#_5-common-issues-and-solutions" aria-label="Permalink to &quot;5. Common Issues and Solutions&quot;">​</a></h2><h3 id="issue-1-results-too-noisy-to-converge" tabindex="-1">Issue 1: Results Too Noisy to Converge <a class="header-anchor" href="#issue-1-results-too-noisy-to-converge" aria-label="Permalink to &quot;Issue 1: Results Too Noisy to Converge&quot;">​</a></h3><p><strong>Problem:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0.1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Very strong privacy</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Noise is so large that convergence criteria never met</span></span></code></pre></div><p><strong>Solution:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Either increase epsilon (weaker privacy)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or use iteration-based stopping</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_converged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, result, last_result):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Don&#39;t rely on value changes</span></span></code></pre></div><h3 id="issue-2-privacy-budget-concerns" tabindex="-1">Issue 2: Privacy Budget Concerns <a class="header-anchor" href="#issue-2-privacy-budget-concerns" aria-label="Permalink to &quot;Issue 2: Privacy Budget Concerns&quot;">​</a></h3><p><strong>Problem:</strong> Multiple iterations consume privacy budget additively.</p><p><strong>Solution:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Allocate budget per iteration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">total_epsilon </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 5</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">epsilon_per_iteration </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> total_epsilon </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_iterations  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 0.2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Or stop early to preserve budget</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_converged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, result, last_result):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    privacy_budget_used </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">*</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.epsilon</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> privacy_budget_used </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1.0</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Stop when budget exhausted</span></span></code></pre></div><h3 id="issue-3-incorrect-sensitivity" tabindex="-1">Issue 3: Incorrect Sensitivity <a class="header-anchor" href="#issue-3-incorrect-sensitivity" aria-label="Permalink to &quot;Issue 3: Incorrect Sensitivity&quot;">​</a></h3><p><strong>Problem:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # But data actually ranges 0-100</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Privacy guarantee is compromised!</span></span></code></pre></div><p><strong>Solution:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Calculate proper sensitivity</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> max_value </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> min_value  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 100 - 0 = 100</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">num_nodes </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(data_splits)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 2</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">sensitivity </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> data_range </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> num_nodes  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># 100 / 2 = 50</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StarModelTester(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">...</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">50</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><h3 id="issue-4-non-numeric-results" tabindex="-1">Issue 4: Non-Numeric Results <a class="header-anchor" href="#issue-4-non-numeric-results" aria-label="Permalink to &quot;Issue 4: Non-Numeric Results&quot;">​</a></h3><p><strong>Problem:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;mean&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">4.5</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;std&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Dict not supported!</span></span></code></pre></div><p><strong>Solution:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results):</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> sum</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">/</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> len</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(analysis_results)  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Single number only</span></span></code></pre></div><h2 id="_6-next-steps" tabindex="-1">6. Next Steps <a class="header-anchor" href="#_6-next-steps" aria-label="Permalink to &quot;6. Next Steps&quot;">​</a></h2><h3 id="_6-1-move-to-production" tabindex="-1">6.1. Move to Production <a class="header-anchor" href="#_6-1-move-to-production" aria-label="Permalink to &quot;6.1. Move to Production&quot;">​</a></h3><p>After local testing succeeds:</p><ol><li><strong>Replace <code>StarModelTester</code> with <code>StarLocalDPModel</code></strong>:<div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flame.star </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StarLocalDPModel</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">StarLocalDPModel(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    analyzer</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MyAnalyzer,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    aggregator</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">MyAggregator,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    data_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;fhir&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Real FHIR server</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    query</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Patient?_summary=count&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    simple_analysis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    epsilon</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">    sensitivity</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1.0</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div></li><li><strong>Configure real data sources</strong> (FHIR servers, S3 buckets)</li><li><strong>Ensure no logging of true results in production!</strong></li></ol>`,80)]))}const y=i(e,[["render",l]]);export{o as __pageData,y as default};
