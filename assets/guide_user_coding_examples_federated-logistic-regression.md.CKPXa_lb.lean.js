import{_ as i,c as a,a0 as e,o as n}from"./chunks/framework.BGabeMLJ.js";const g=JSON.parse('{"title":"FLAME Pancreas Analysis Tutorial","description":"","frontmatter":{},"headers":[],"relativePath":"guide/user/coding_examples/federated-logistic-regression.md","filePath":"guide/user/coding_examples/federated-logistic-regression.md"}'),t={name:"guide/user/coding_examples/federated-logistic-regression.md"};function l(h,s,p,r,o,d){return n(),a("div",null,s[0]||(s[0]=[e(`<h1 id="flame-pancreas-analysis-tutorial" tabindex="-1">FLAME Pancreas Analysis Tutorial <a class="header-anchor" href="#flame-pancreas-analysis-tutorial" aria-label="Permalink to &quot;FLAME Pancreas Analysis Tutorial&quot;">​</a></h1><p>This guide provides a complete walkthrough of the pancreas analysis example, which demonstrates federated logistic regression using the STAR pattern. This tutorial explains how different components work together to train a machine learning model across distributed healthcare data without centralizing patient information.</p><h2 id="_1-overview" tabindex="-1">1. Overview <a class="header-anchor" href="#_1-overview" aria-label="Permalink to &quot;1. Overview&quot;">​</a></h2><p>This example implements <strong>Federated Logistic Regression</strong> for pancreas disease classification. In this scenario:</p><ul><li>Multiple hospitals (nodes) have local patient data with pancreas measurements</li><li>Each hospital trains a logistic regression model on its local data</li><li>A central aggregator combines the model updates using <strong>Federated Averaging (FedAvg)</strong></li><li>The process iterates until the global model converges</li><li><strong>No patient data ever leaves the local hospitals</strong></li></ul><h3 id="_1-1-why-federated-learning-for-healthcare" tabindex="-1">1.1. Why Federated Learning for Healthcare? <a class="header-anchor" href="#_1-1-why-federated-learning-for-healthcare" aria-label="Permalink to &quot;1.1. Why Federated Learning for Healthcare?&quot;">​</a></h3><p>Healthcare data is:</p><ul><li><strong>Private</strong>: Patient data must remain at the source institution</li><li><strong>Distributed</strong>: Different hospitals have different patient populations</li><li><strong>Sensitive</strong>: Regulatory requirements (HIPAA, GDPR) restrict data sharing</li></ul><p>Federated learning enables collaborative model training while respecting these constraints.</p><h3 id="_1-2-architecture" tabindex="-1">1.2. Architecture <a class="header-anchor" href="#_1-2-architecture" aria-label="Permalink to &quot;1.2. Architecture&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>┌─────────────────┐         ┌─────────────────┐</span></span>
<span class="line"><span>│   Hospital 1    │         │   Hospital 2    │</span></span>
<span class="line"><span>│                 │         │                 │</span></span>
<span class="line"><span>│  PancreasData   │         │  PancreasData   │</span></span>
<span class="line"><span>│      ↓          │         │      ↓          │</span></span>
<span class="line"><span>│ PancreasAnalyzer│         │ PancreasAnalyzer│</span></span>
<span class="line"><span>│      ↓          │         │      ↓          │</span></span>
<span class="line"><span>│ Local Model     │         │ Local Model     │</span></span>
<span class="line"><span>│  Coefficients   │         │  Coefficients   │</span></span>
<span class="line"><span>└────────┬────────┘         └────────┬────────┘</span></span>
<span class="line"><span>         │                           │</span></span>
<span class="line"><span>         └────────────┬──────────────┘</span></span>
<span class="line"><span>                      ↓</span></span>
<span class="line"><span>         ┌────────────────────────┐</span></span>
<span class="line"><span>         │   Aggregator Node      │</span></span>
<span class="line"><span>         │                        │</span></span>
<span class="line"><span>         │ FederatedLogistic      │</span></span>
<span class="line"><span>         │    Regression          │</span></span>
<span class="line"><span>         │         ↓              │</span></span>
<span class="line"><span>         │  Global Model          │</span></span>
<span class="line"><span>         │    Parameters          │</span></span>
<span class="line"><span>         └────────────────────────┘</span></span>
<span class="line"><span>                      ↓</span></span>
<span class="line"><span>         (Iterate until convergence)</span></span></code></pre></div><h2 id="_2-code-walkthrough" tabindex="-1">2. Code Walkthrough <a class="header-anchor" href="#_2-code-walkthrough" aria-label="Permalink to &quot;2. Code Walkthrough&quot;">​</a></h2><h3 id="_2-1-imports-and-setup" tabindex="-1">2.1. Imports and Setup <a class="header-anchor" href="#_2-1-imports-and-setup" aria-label="Permalink to &quot;2.1. Imports and Setup&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pandas </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> numpy </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">as</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.linear_model </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LogisticRegression</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> io </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> BytesIO</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> flame.star </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StarAnalyzer, StarAggregator, StarModel</span></span></code></pre></div><p><strong>What&#39;s happening:</strong></p><ul><li><strong>pandas</strong>: Loads and processes CSV data</li><li><strong>numpy</strong>: Handles numerical operations (arrays, linear algebra)</li><li><strong>LogisticRegression</strong>: The machine learning model we&#39;re training</li><li><strong>BytesIO</strong>: Handles in-memory byte streams (data arrives as bytes)</li><li><strong>flame.star</strong>: FLAME framework components for federated learning</li></ul><h3 id="_2-2-the-pancreasanalyzer-class" tabindex="-1">2.2. The PancreasAnalyzer Class <a class="header-anchor" href="#_2-2-the-pancreasanalyzer-class" aria-label="Permalink to &quot;2.2. The PancreasAnalyzer Class&quot;">​</a></h3><p>The analyzer runs at each hospital and performs local training.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> PancreasAnalyzer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StarAnalyzer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Local analyzer executed independently on each federated node.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Responsible for loading node-local data and computing model updates.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, flame):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flame)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        </span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LogisticRegression(</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            max_iter</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># One optimization step per federated round</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            fit_intercept</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,  </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Intercept omitted for simplicity</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            warm_start</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">       # Enables parameter reuse across iterations</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span></code></pre></div><p><strong>Key Configuration Choices:</strong></p><ul><li><p><strong><code>max_iter=1</code></strong>: Each federated round does ONE gradient descent step</p><ul><li>Why? Because we want fine-grained synchronization between nodes</li><li>Each hospital updates the model slightly, then syncs with others</li></ul></li><li><p><strong><code>fit_intercept=False</code></strong>: Simplifies the model (no bias term)</p><ul><li>Makes coefficient aggregation straightforward</li><li>In production, you might want to include the intercept</li></ul></li><li><p><strong><code>warm_start=True</code></strong>: Critical for federated learning!</p><ul><li>Preserves model parameters between <code>.fit()</code> calls</li><li>Each round starts from the aggregated global parameters</li><li>Without this, the model would reset each time</li></ul></li></ul><h4 id="_2-2-1-the-analysis-method" tabindex="-1">2.2.1. The Analysis Method <a class="header-anchor" href="#_2-2-1-the-analysis-method" aria-label="Permalink to &quot;2.2.1. The Analysis Method&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> analysis_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, data, aggregator_results):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Load local CSV data from byte stream</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pancreas_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.read_csv(BytesIO(data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Split features and labels (last column assumed to be target)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    data, labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pancreas_df.iloc[:, :</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], pancreas_df.iloc[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Initialize model coefficients with global parameters</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Perform one local fitting step</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.fit(data, labels)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # During the first iteration, no global parameters exist yet</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        aggregator_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_.copy()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Return updated coefficients to the aggregator</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_</span></span></code></pre></div><p><strong>Step-by-step breakdown:</strong></p><ol><li><p><strong>Data Loading</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pancreas_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.read_csv(BytesIO(data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span></code></pre></div><ul><li><code>data[0]</code> is a dictionary: <code>{&#39;pancreasData.csv&#39;: &lt;bytes&gt;}</code></li><li><code>BytesIO()</code> creates an in-memory file from bytes</li><li><code>pd.read_csv()</code> parses the CSV into a DataFrame</li></ul></li><li><p><strong>Feature-Label Split</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">data, labels </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pancreas_df.iloc[:, :</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], pancreas_df.iloc[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span></code></pre></div><ul><li>All columns except the last are features (patient measurements)</li><li>Last column is the label (disease classification: 0 or 1)</li></ul></li><li><p><strong>Initialize with Global Parameters</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> aggregator_results</span></span></code></pre></div><ul><li>Sets the model&#39;s starting point to the global parameters</li><li>This ensures all nodes start from the same synchronized state</li><li>On first iteration, <code>aggregator_results</code> is <code>None</code></li></ul></li><li><p><strong>Local Training</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.fit(data, labels)</span></span></code></pre></div><ul><li>Performs ONE step of gradient descent (remember <code>max_iter=1</code>)</li><li>Updates coefficients based on local data</li><li>The model improves slightly based on this hospital&#39;s patients</li></ul></li><li><p><strong>First Iteration Handling</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aggregator_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_.copy()</span></span></code></pre></div><ul><li>On the first round, there&#39;s no global model yet</li><li>Each hospital initializes its own coefficients</li><li>These local initializations will be averaged to create the first global model</li></ul></li><li><p><strong>Return Local Update</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_</span></span></code></pre></div><ul><li>Sends the updated coefficients to the aggregator</li><li>These are numpy arrays with shape <code>(1, num_features)</code></li></ul></li></ol><h3 id="_2-3-the-federatedlogisticregression-aggregator" tabindex="-1">2.3. The FederatedLogisticRegression Aggregator <a class="header-anchor" href="#_2-3-the-federatedlogisticregression-aggregator" aria-label="Permalink to &quot;2.3. The FederatedLogisticRegression Aggregator&quot;">​</a></h3><p>The aggregator combines updates from all hospitals.</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">class</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> FederatedLogisticRegression</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StarAggregator</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    Aggregator responsible for combining model updates</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    and checking convergence across federated rounds.</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">    &quot;&quot;&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    def</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> __init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, flame):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        super</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">().</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">__init__</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(flame)</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.max_iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 10</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # Maximum number of federated iterations</span></span></code></pre></div><p><strong>Configuration:</strong></p><ul><li><code>max_iter=10</code>: Safety limit to prevent infinite training</li><li>Convergence might happen earlier (see <code>has_converged()</code>)</li></ul><h4 id="_2-3-1-the-aggregation-method" tabindex="-1">2.3.1. The Aggregation Method <a class="header-anchor" href="#_2-3-1-the-aggregation-method" aria-label="Permalink to &quot;2.3.1. The Aggregation Method&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> aggregation_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, analysis_results):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Stack coefficient arrays from all nodes</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    coefs </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.stack(analysis_results, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Compute mean across nodes (Federated Averaging)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    global_params_ </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> coefs.mean(</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">axis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> global_params_</span></span></code></pre></div><p><strong>How Federated Averaging Works:</strong></p><p>Imagine two hospitals:</p><ul><li>Hospital 1 has coefficients: <code>[0.5, 0.8, 0.2]</code></li><li>Hospital 2 has coefficients: <code>[0.3, 0.6, 0.4]</code></li></ul><p>The aggregation computes:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>global_model = ([0.5, 0.8, 0.2] + [0.3, 0.6, 0.4]) / 2</span></span>
<span class="line"><span>             = [0.4, 0.7, 0.3]</span></span></code></pre></div><p>This global model:</p><ul><li>Represents knowledge from both hospitals</li><li>Doesn&#39;t favor any single institution</li><li>Becomes the starting point for the next training round</li></ul><p><strong>Why This Works:</strong></p><ul><li>Linear models (like logistic regression) can be safely averaged</li><li>The average of local optima approximates the global optimum</li><li>More sophisticated aggregation schemes exist (weighted averaging, momentum, etc.)</li></ul><h4 id="_2-3-2-the-convergence-check" tabindex="-1">2.3.2. The Convergence Check <a class="header-anchor" href="#_2-3-2-the-convergence-check" aria-label="Permalink to &quot;2.3.2. The Convergence Check&quot;">​</a></h4><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> has_converged</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, result, last_result):</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">     # exclude first iteration from convergence check, because last result is None</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">is</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> None</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # L2 norm of parameter difference</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    if</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> np.linalg.norm(result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_result, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">).item() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;Delta error is smaller than the tolerance threshold&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;info&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Stop if maximum number of iterations is reached</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    elif</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.max_iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">):</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">        self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.flame.flame_log(</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">            f</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;Maximum number of </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">{self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.max_iter</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">}</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> iterations reached. &quot;</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">            &quot;Returning current results.&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">            log_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;info&quot;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        )</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">        return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> True</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    return</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> False</span></span></code></pre></div><p><strong>Convergence Criteria Explained:</strong></p><ol><li><p><strong>Parameter Stability</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">np.linalg.norm(result </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> last_result, </span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ord</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&lt;=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1e-8</span></span></code></pre></div><ul><li>Computes the L2 (Euclidean) distance between consecutive models</li><li>If the model parameters barely change, training has converged</li><li><code>1e-8</code> is a very small threshold (parameters differ by &lt; 0.00000001)</li></ul></li><li><p><strong>Maximum Iterations</strong>:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> (</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.max_iter </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span></code></pre></div><ul><li>Prevents infinite training loops</li><li>After 10 rounds, stop regardless of convergence</li><li>Protects against poorly-configured models</li></ul></li></ol><p><strong>Why Two Criteria?</strong></p><ul><li>Best case: Model converges early (saves computation)</li><li>Worst case: Model reaches max iterations (prevents hanging)</li></ul><h3 id="_2-4-starmodel-instantiation-putting-it-all-together" tabindex="-1">2.4. StarModel Instantiation - Putting It All Together <a class="header-anchor" href="#_2-4-starmodel-instantiation-putting-it-all-together" aria-label="Permalink to &quot;2.4. StarModel Instantiation - Putting It All Together&quot;">​</a></h3><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> main</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">():</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Run federated training</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    StarModel(               </span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        PancreasAnalyzer,               </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Analyzer class</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        FederatedLogisticRegression,    </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Aggregator class</span></span>
<span class="line"><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">        &#39;s3&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,                           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Data source type</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        simple_analysis</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">False</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,          </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Multi-round analysis</span></span>
<span class="line"><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">        output_type</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pickle&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,           </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Output format</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    )</span></span></code></pre></div><p><strong>StarModel Configuration:</strong></p><table tabindex="0"><thead><tr><th>Parameter</th><th>Value</th><th>Purpose</th></tr></thead><tbody><tr><td><code>PancreasAnalyzer</code></td><td>Class</td><td>Local training logic</td></tr><tr><td><code>FederatedLogisticRegression</code></td><td>Class</td><td>Aggregation logic</td></tr><tr><td><code>&#39;s3&#39;</code></td><td>Data type</td><td>Treats data as S3-like objects</td></tr><tr><td><code>simple_analysis=False</code></td><td>Iterative</td><td>Enables multi-round training</td></tr><tr><td><code>output_type=&#39;pickle&#39;</code></td><td>Format</td><td>Serializes the final model</td></tr></tbody></table><h2 id="_3-training-flow-example" tabindex="-1">3. Training Flow Example <a class="header-anchor" href="#_3-training-flow-example" aria-label="Permalink to &quot;3. Training Flow Example&quot;">​</a></h2><p>Let&#39;s trace through two complete iterations:</p><h3 id="_3-1-iteration-0-first-round" tabindex="-1">3.1. Iteration 0 (First Round) <a class="header-anchor" href="#_3-1-iteration-0-first-round" aria-label="Permalink to &quot;3.1. Iteration 0 (First Round)&quot;">​</a></h3><ol><li><p><strong>Hospital 1 Analyzer</strong>:</p><ul><li>Loads local pancreas data</li><li><code>aggregator_results</code> is <code>None</code> (first iteration)</li><li>Initializes LogisticRegression and trains for 1 step</li><li>Returns coefficients: <code>coef_1 = [0.12, 0.45, 0.33, ...]</code></li></ul></li><li><p><strong>Hospital 2 Analyzer</strong>:</p><ul><li>Loads local pancreas data</li><li><code>aggregator_results</code> is <code>None</code></li><li>Initializes LogisticRegression and trains for 1 step</li><li>Returns coefficients: <code>coef_2 = [0.18, 0.52, 0.28, ...]</code></li></ul></li><li><p><strong>Aggregator</strong>:</p><ul><li>Receives <code>[coef_1, coef_2]</code></li><li>Computes average: <code>global_coef = (coef_1 + coef_2) / 2</code></li><li>Checks convergence: <code>last_result</code> is <code>None</code>, so continues</li><li>Returns <code>global_coef</code> to all analyzers</li></ul></li></ol><h3 id="_3-2-iteration-1-second-round" tabindex="-1">3.2. Iteration 1 (Second Round) <a class="header-anchor" href="#_3-2-iteration-1-second-round" aria-label="Permalink to &quot;3.2. Iteration 1 (Second Round)&quot;">​</a></h3><ol><li><p><strong>Hospital 1 Analyzer</strong>:</p><ul><li>Loads local data again</li><li><code>aggregator_results = global_coef</code> (from iteration 0)</li><li>Sets <code>self.clf.coef_ = global_coef</code> (warm start)</li><li>Trains for 1 step (refines the global model on local data)</li><li>Returns updated coefficients: <code>coef_1_new</code></li></ul></li><li><p><strong>Hospital 2 Analyzer</strong>:</p><ul><li>Loads local data again</li><li><code>aggregator_results = global_coef</code></li><li>Sets <code>self.clf.coef_ = global_coef</code></li><li>Trains for 1 step</li><li>Returns updated coefficients: <code>coef_2_new</code></li></ul></li><li><p><strong>Aggregator</strong>:</p><ul><li>Receives <code>[coef_1_new, coef_2_new]</code></li><li>Computes new average: <code>global_coef_new</code></li><li>Checks convergence: <ul><li>Computes <code>||global_coef_new - global_coef||</code></li><li>If small enough, training stops</li><li>Otherwise, continues to iteration 2</li></ul></li></ul></li></ol><p>This process repeats until convergence or max iterations.</p><h2 id="_4-key-concepts-explained" tabindex="-1">4. Key Concepts Explained <a class="header-anchor" href="#_4-key-concepts-explained" aria-label="Permalink to &quot;4. Key Concepts Explained&quot;">​</a></h2><h3 id="_4-1-warm-start-vs-cold-start" tabindex="-1">4.1. Warm Start vs. Cold Start <a class="header-anchor" href="#_4-1-warm-start-vs-cold-start" aria-label="Permalink to &quot;4.1. Warm Start vs. Cold Start&quot;">​</a></h3><p>Many machine learning model libraries reset their model&#39;s parameters on each <code>.fit()</code> call by default, a practice often called <strong>Cold Start</strong> (see Example).</p><h4 id="_4-1-1-cold-start-warm-start-false" tabindex="-1">4.1.1. Cold Start (warm_start=False): <a class="header-anchor" href="#_4-1-1-cold-start-warm-start-false" aria-label="Permalink to &quot;4.1.1. Cold Start (warm_start=False):&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Round 1: Initialize → Train</span></span>
<span class="line"><span>Round 2: Initialize → Train  (loses progress!)</span></span>
<span class="line"><span>Round 3: Initialize → Train</span></span></code></pre></div><p><em>Here, each round starts from scratch, which is not useful for federated learning.</em></p><p>Most libraries, including <code>sklearn</code>, thereby provide a <strong>Warm Start</strong> option. This enables the manual application of model coefficients from previous iterations.</p><h4 id="_4-1-2-warm-start-warm-start-true" tabindex="-1">4.1.2. Warm Start (warm_start=True): <a class="header-anchor" href="#_4-1-2-warm-start-warm-start-true" aria-label="Permalink to &quot;4.1.2. Warm Start (warm_start=True):&quot;">​</a></h4><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Round 1: Initialize → Train</span></span>
<span class="line"><span>Round 2: Continue from Round 1 → Train</span></span>
<span class="line"><span>Round 3: Continue from Round 2 → Train</span></span></code></pre></div><p><em>Each round builds on previous progress. Essential for federated learning.</em></p><h3 id="_4-2-why-max-iter-1" tabindex="-1">4.2. Why max_iter=1? <a class="header-anchor" href="#_4-2-why-max-iter-1" aria-label="Permalink to &quot;4.2. Why max_iter=1?&quot;">​</a></h3><p><strong>Multiple iterations per round (max_iter=100)</strong>:</p><ul><li>Each hospital trains independently for 100 steps</li><li>Individual models diverge from each other more rapidly</li><li>Aggregation less effective, slower convergence</li></ul><p><strong>Single iteration per round (max_iter=1)</strong>:</p><ul><li>Each hospital takes one small step</li><li>Frequent synchronization keeps models aligned</li><li>Better convergence properties</li></ul><h3 id="_4-3-data-privacy-guarantee" tabindex="-1">4.3. Data Privacy Guarantee <a class="header-anchor" href="#_4-3-data-privacy-guarantee" aria-label="Permalink to &quot;4.3. Data Privacy Guarantee&quot;">​</a></h3><h5 id="notice-what-never-leaves-each-hospital" tabindex="-1">Notice what NEVER leaves each hospital: <a class="header-anchor" href="#notice-what-never-leaves-each-hospital" aria-label="Permalink to &quot;Notice what NEVER leaves each hospital:&quot;">​</a></h5><p>❌ Raw patient data, able to be traced back to individuals</p><h5 id="what-does-get-shared" tabindex="-1">What DOES get shared: <a class="header-anchor" href="#what-does-get-shared" aria-label="Permalink to &quot;What DOES get shared:&quot;">​</a></h5><p>✅ Model coefficients, not patient data (ex. numbers like <code>[0.4, 0.7, 0.3]</code>; coefficients: mathematical vector parameters used to distinguish arbitrary categories)</p><h2 id="_5-running-the-example" tabindex="-1">5. Running the Example <a class="header-anchor" href="#_5-running-the-example" aria-label="Permalink to &quot;5. Running the Example&quot;">​</a></h2><p>To run this example you need a project set up in FLAME with nodes that have access to pancreas data CSV files. How to do that look at the <a href="/guide/user/project.html">Submitting a Project Proposal</a> and <a href="/guide/user/analysis.html">Starting an Analysis</a></p><h2 id="_6-troubleshooting" tabindex="-1">6. Troubleshooting <a class="header-anchor" href="#_6-troubleshooting" aria-label="Permalink to &quot;6. Troubleshooting&quot;">​</a></h2><h3 id="_6-1-issue-valueerror-this-logisticregression-instance-is-not-fitted-yet" tabindex="-1">6.1. Issue: &quot;ValueError: This LogisticRegression instance is not fitted yet&quot; <a class="header-anchor" href="#_6-1-issue-valueerror-this-logisticregression-instance-is-not-fitted-yet" aria-label="Permalink to &quot;6.1. Issue: &quot;ValueError: This LogisticRegression instance is not fitted yet&quot;&quot;">​</a></h3><p><strong>Cause</strong>: The model&#39;s <code>coef_</code> attribute wasn&#39;t initialized properly.</p><p><strong>Solution</strong>: Ensure the first iteration handles None:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">if</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.num_iterations </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    aggregator_results </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.clf.coef_.copy()</span></span></code></pre></div><h3 id="_6-2-issue-training-never-converges" tabindex="-1">6.2. Issue: Training never converges <a class="header-anchor" href="#_6-2-issue-training-never-converges" aria-label="Permalink to &quot;6.2. Issue: Training never converges&quot;">​</a></h3><p><strong>Cause</strong>: Convergence threshold too strict or learning not effective.</p><p><strong>Solutions</strong>:</p><ol><li>Increase tolerance: <code>1e-8</code> → <code>1e-5</code></li><li>Reduce max_iter in analyzer: Forces smaller updates</li><li>Check data quality: Ensure all nodes have meaningful data</li></ol><h3 id="_6-3-issue-shape-mismatch-errors" tabindex="-1">6.3. Issue: &quot;Shape mismatch&quot; errors <a class="header-anchor" href="#_6-3-issue-shape-mismatch-errors" aria-label="Permalink to &quot;6.3. Issue: &quot;Shape mismatch&quot; errors&quot;">​</a></h3><p><strong>Cause</strong>: Different nodes have different numbers of features.</p><p><strong>Solution</strong>: Ensure all <code>pancreasData.csv</code> files have the same columns:</p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Validate data</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">pancreas_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.read_csv(BytesIO(data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">expected_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 8</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # For example</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">assert</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pancreas_df.shape[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">==</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> expected_features </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">+</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 1</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">  # +1 for label</span></span></code></pre></div><h3 id="_6-4-issue-poor-model-performance" tabindex="-1">6.4. Issue: Poor model performance <a class="header-anchor" href="#_6-4-issue-poor-model-performance" aria-label="Permalink to &quot;6.4. Issue: Poor model performance&quot;">​</a></h3><p><strong>Possible causes:</strong></p><ol><li>Insufficient iterations (increase <code>max_iter</code> in aggregator)</li><li>Unbalanced data (some nodes have very different distributions)</li><li>Model too simple (try more complex models)</li><li>Need feature engineering (normalize, add polynomial features)</li></ol><p><strong>Solutions:</strong></p><div class="language-python vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">python</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Normalize features</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> sklearn.preprocessing </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StandardScaler</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">def</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> analysis_method</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(self, data, aggregator_results):</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    pancreas_df </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pd.read_csv(BytesIO(data[</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">0</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">][</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;pancreasData.csv&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]))</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X, y </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> pancreas_df.iloc[:, :</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">], pancreas_df.iloc[:, </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Normalize</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    scaler </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> StandardScaler()</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    X </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> scaler.fit_transform(X)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    </span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    # Continue with training...</span></span></code></pre></div><h2 id="_7-best-practices" tabindex="-1">7. Best Practices <a class="header-anchor" href="#_7-best-practices" aria-label="Permalink to &quot;7. Best Practices&quot;">​</a></h2><ol><li><strong>Always use warm_start=True</strong> for iterative federated learning</li><li><strong>Set max_iter=1</strong> in the local model for fine-grained synchronization</li><li><strong>Handle the first iteration</strong> where aggregator_results is None</li><li><strong>Include convergence checks</strong> to prevent infinite loops</li><li><strong>Log important events</strong> using <code>self.flame.flame_log()</code></li><li><strong>Validate data shapes</strong> to catch configuration errors early</li><li><strong>Test with 2-3 nodes first</strong> before scaling up</li><li><strong>Save intermediate results</strong> during development for debugging</li><li><strong>Utilize <a href="/guide/user/testing_examples/local-testing-logistic-regression-example.html">FlameSDK&#39;s built-in testing environments</a></strong> to simulate and test your federated pipeline execution</li><li><strong>Integrate given class fields</strong> (like <code>self.num_iterations</code>) efficiently instead of creating new tracking variables with identical purpose</li></ol>`,100)]))}const c=i(t,[["render",l]]);export{g as __pageData,c as default};
